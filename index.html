<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esports Calendar (CS2)</title>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet" />

  <!-- Tu CSS -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
  <header class="header">
    <h1 id="pageTitle">Calendario de Esports (CS2)</h1>
  </header>

  <div class="container mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <div class="language-switch">
        <button id="lang-es" class="language-btn" onclick="setLanguage('es')">ðŸ‡ªðŸ‡¸</button>
        <button id="lang-en" class="language-btn" onclick="setLanguage('en')">ðŸ‡ºðŸ‡¸</button>
      </div>
      <button id="toggleTheme" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Modo Claro</button>
    </div>

    <p id="storageNote" class="text-center text-gray-400 mb-6">
      Los datos se guardan localmente en tu navegador. Exporta tu calendario para respaldarlo o compartirlo. No compartas el archivo JSON si contiene informaciÃ³n sensible.
    </p>

    <!-- Today's Highlights -->
    <div id="highlightsSection" class="card mb-6">
      <h2 id="highlightsTitle" class="text-xl font-semibold mb-4 text-white flex items-center gap-2">
        ðŸ”¥ <span>Today's Highlights</span>
      </h2>
      <div class="flex items-center gap-3 mb-2">
        <label for="highlightsFavOnly" class="text-sm text-gray-300">Favorites only</label>
        <input id="highlightsFavOnly" type="checkbox" />
      </div>
      <div id="highlightsContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Highlights will be dynamically added here -->
      </div>
      <div id="noHighlights" class="text-gray-400 text-center py-8 hidden">
        No tournaments today or tomorrow
      </div>
    </div>

    <!-- Calendar -->
    <div id="calendar" class="card mb-6"></div>

    <!-- Leyenda de colores -->
    <div class="card mb-6">
      <div id="legend" class="flex flex-wrap gap-4 items-center text-sm">
        <!-- Se rellena por JS (renderLegend) -->
      </div>
    </div>

    <!-- Formulario para agregar/editar torneos -->
    <div class="card mb-6" style="border-top: 4px solid #3b82f6;">
      <div class="flex justify-between items-center cursor-pointer" onclick="toggleAddForm()">
        <h2 id="formTitle" class="text-xl font-semibold text-white m-0">Agregar Nuevo Torneo</h2>
        <span id="toggleFormIcon" class="text-xl text-gray-400 transition-transform duration-200">â–¼</span>
      </div>
      <div id="addTournamentFormBody" class="hidden mt-6 grid md:grid-cols-2 gap-4">
        <!-- Name -->
        <div class="col-span-2">
          <label class="form-label">Tournament Name</label>
          <input id="tournamentName" type="text" placeholder="Nombre del Torneo" class="w-full" />
        </div>
        
        <!-- Tier & Color -->
        <div>
          <label class="form-label">Tier</label>
          <select id="tournamentTier" class="w-full">
            <option value="S">S - Maximum Relevance</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
          </select>
        </div>
        <div>
          <label class="form-label">Color</label>
          <select id="tournamentColor" class="w-full">
            <option value="blue">Blue</option>
            <option value="orange">Orange</option>
            <option value="green">Green</option>
            <option value="red">Red</option>
            <option value="purple">Purple</option>
            <option value="yellow">Yellow</option>
          </select>
        </div>

        <!-- Dates -->
        <div>
          <label id="startDateLabel" for="startDate" class="form-label">Start Date</label>
          <input id="startDate" type="date" class="w-full" />
        </div>
        <div>
          <label id="endDateLabel" for="endDate" class="form-label">End Date</label>
          <input id="endDate" type="date" class="w-full" />
        </div>

        <!-- Teams -->
        <div class="col-span-2">
          <label class="form-label">Teams (comma separated)</label>
          <div class="relative group">
            <div id="teamTagsInput" class="tags-input-container" onclick="document.getElementById('tournamentTeams').focus()">
              <!-- tags will be inserted here by renderInputTags -->
              <input id="tournamentTeams" type="text" placeholder="Equipos (separados por coma)" style="background: transparent; color: #f3f4f6; border: none; outline: none; flex: 1; min-width: 100px;" autocomplete="off" />
            </div>
            <div id="teamsAutocompleteDropdown" class="autocomplete-dropdown hidden"></div>
          </div>
        </div>

        <!-- Location & Modality -->
        <div>
          <label class="form-label">Location</label>
          <input id="tournamentLocation" type="text" placeholder="UbicaciÃ³n (ej. Londres, Online)" class="w-full" />
        </div>
        <div>
          <label class="form-label">Modality</label>
          <select id="tournamentModality" class="w-full">
            <option value="Online">Online</option>
            <option value="Offline">Offline</option>
            <option value="Online/Offline">Online/Offline</option>
          </select>
        </div>

        <!-- VRS -->
        <div class="col-span-2 flex items-center gap-2 mt-2">
          <input id="tournamentVRS" type="checkbox" class="w-4 h-4" />
          <label id="vrsLabel" for="tournamentVRS" class="text-gray-300 cursor-pointer select-none">
            VRS (Valorant Ranking System)
          </label>
        </div>
      </div>
      
      <!-- Buttons -->
      <div id="addTournamentButtons" class="hidden mt-6 flex flex-wrap gap-2 justify-end">
        <button id="saveButton" onclick="saveTournament()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-bold transition-colors">Agregar Torneo</button>
        <button id="cancelEditButton" onclick="cancelEdit()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded font-bold transition-colors hidden">Cancelar</button>
        
        <div class="flex-grow"></div> <!-- Spacer -->
        
        <button id="exportButton" onclick="exportTournaments()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold transition-colors">Exportar</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importTournaments(event)" />
        <button id="importButton" onclick="document.getElementById('importFile').click()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded font-bold transition-colors">Importar</button>
        <button id="exportICS" onclick="exportICS()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded font-bold transition-colors">Exportar ICS</button>
        <button id="helpButton" onclick="showHelp()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded font-bold transition-colors">Ayuda</button>
        <button id="clearAllButton" onclick="confirmClearAll()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-bold transition-colors">Borrar todo</button>
      </div>
    </div>


    <!-- Tabla de torneos -->
    <div class="card">
      <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
        <h3 class="text-xl font-semibold text-white">Tournaments List</h3>
        <div class="view-toggle">
          <button id="viewCards" onclick="setView('cards')" class="view-toggle-btn active">ðŸŽ´ Cards</button>
          <button id="viewTable" onclick="setView('table')" class="view-toggle-btn">ðŸ“Š Table</button>
        </div>
      </div>

      <!-- Filtros integrados -->
      <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 mb-4">
        <div class="grid grid-cols-1 md:grid-cols-6 gap-3">
          <input id="fText" type="text" placeholder="" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600 w-full" />
          <select id="fTier" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600 w-full">
            <option value=""></option>
            <option value="S">S</option><option value="A">A</option>
            <option value="B">B</option><option value="C">C</option>
          </select>
          <select id="fModality" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600 w-full">
            <option value=""></option>
            <option value="Online">Online</option>
            <option value="Offline">Offline</option>
            <option value="Online/Offline">Online/Offline</option>
          </select>
          <input id="fLocation" type="text" placeholder="" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600 w-full" />
          <input id="fFrom" type="date" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600" />
          <input id="fTo" type="date" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600" />
        </div>
        <div class="mt-3 flex gap-3 items-center">
          <select id="fVRS" class="p-2 border rounded bg-gray-700 text-gray-100 border-gray-600">
            <option value=""></option>
            <option value="1"></option>
            <option value="0"></option>
          </select>
          <input id="fFav" type="checkbox" class="w-4 h-4" />
          <label id="fFavLabel" for="fFav" class="text-gray-300 cursor-pointer select-none">
            Favorites
          </label>
          <button id="btnClearFilters" class="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700"></button>
        </div>
      </div>

      <table id="tournamentTable" class="min-w-full bg-gray-800 rounded-lg">
        <thead>
          <tr class="bg-gray-700 text-gray-300 uppercase text-sm leading-normal">
            <th id="thTournament" class="py-3 px-6 text-left">Torneo</th>
            <th id="thTier" class="py-3 px-6 text-left">Tier</th>
            <th id="thDates" class="py-3 px-6 text-left cursor-pointer" onclick="sortByDate()">Fechas</th>
            <th id="thTeams" class="py-3 px-6 text-left">Equipos</th>
            <th id="thLocation" class="py-3 px-6 text-left">UbicaciÃ³n</th>
            <th id="thModality" class="py-3 px-6 text-left">Modalidad</th>
            <th id="thColor" class="py-3 px-6 text-left">Color</th>
            <th id="thVRS" class="py-3 px-6 text-left cursor-pointer" onclick="sortByVRS()">VRS</th>
            <th id="thActions" class="py-3 px-6 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody id="tournamentBody" class="text-gray-300 text-sm font-light">
          <!-- Los torneos se agregarÃ¡n aquÃ­ dinÃ¡micamente -->
        </tbody>
      </table>
    </div>

    <!-- Modal de ayuda -->
    <div id="helpModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex items-center justify-center">
      <div class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
        <h3 id="helpTitle" class="text-xl font-semibold mb-4 text-white">Ayuda</h3>
        <p id="helpIntro" class="text-gray-300 mb-4">Bienvenido al Calendario de Esports (CS2). AquÃ­ tienes las instrucciones bÃ¡sicas:</p>
        <ul id="helpList" class="list-disc list-inside text-gray-300 mb-4">
          <li><strong id="helpAdd">Agregar Torneo:</strong> Completa el formulario y haz clic en "Agregar Torneo".</li>
          <li><strong id="helpEdit">Editar Torneo:</strong> Haz clic en "Editar" en la tabla o en un evento del calendario.</li>
          <li><strong id="helpDelete">Eliminar Torneo:</strong> Haz clic en "Eliminar" y confirma.</li>
          <li><strong id="helpExport">Exportar:</strong> Descarga un archivo JSON con tus torneos para respaldarlo o compartirlo.</li>
          <li><strong id="helpImport">Importar:</strong> Selecciona un archivo JSON para cargar torneos previos.</li>
          <li><strong id="helpClear">Borrar todo:</strong> Usa "Borrar todo" para eliminar todos los torneos (con confirmaciÃ³n).</li>
          <li><strong id="helpNote">Nota:</strong> Los datos se guardan localmente. No compartas el JSON si contiene informaciÃ³n sensible.</li>
        </ul>
        <button id="closeHelp" onclick="hideHelp()" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Cerrar</button>
      </div>
    </div>
  </div>

  <footer class="bg-gray-800 text-gray-300 p-4 text-center w-full">
    <p>
      Â¿Tienes alguna pregunta? ContÃ¡ctame en:
      <a href="mailto:joacobruses@gmail.com" class="text-blue-400 hover:underline">joacobruses@gmail.com</a>
      | Sigue mis actualizaciones en
      <a href="https://x.com/jbruses_" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">X</a>
    </p>
  </footer>

  <!-- Tu JS -->
  <script type="module" src="js/main.js"></script>
  <script>
    import {
      setLanguage,
      toggleTheme,
      showHelp,
      hideHelp,
      setView,
      toggleAddForm
    } from './js/ui.js';
    import {
      saveTournament,
      cancelEdit,
      exportTournaments,
      importTournaments,
      confirmClearAll,
      sortByDate,
      sortByVRS,
      editTournament,
      confirmDelete,
      toggleFavorite,
      exportICS
    } from './js/tournaments.js';
    import {
      filterByTeam,
      selectAutocompleteTeam,
      selectFormAutocompleteTeam,
      removeTeamTag
    } from './js/utils.js';

    window.setLanguage = setLanguage;
    window.toggleTheme = toggleTheme;
    window.saveTournament = saveTournament;
    window.cancelEdit = cancelEdit;
    window.exportTournaments = exportTournaments;
    window.importTournaments = importTournaments;
    window.showHelp = showHelp;
    window.hideHelp = hideHelp;
    window.confirmClearAll = confirmClearAll;
    window.sortByDate = sortByDate;
    window.sortByVRS = sortByVRS;
    window.editTournament = editTournament;
    window.confirmDelete = confirmDelete;
    window.filterByTeam = filterByTeam;
    window.setView = setView;
    window.toggleFavorite = toggleFavorite;
    window.selectAutocompleteTeam = selectAutocompleteTeam;
    window.selectFormAutocompleteTeam = selectFormAutocompleteTeam;
    window.removeTeamTag = removeTeamTag;
    window.toggleAddForm = toggleAddForm;
    window.exportICS = exportICS;
  </script>
</body>
</html>